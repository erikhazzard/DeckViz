/* ======================================
 * Title: Data Viz
 * Author: Erik & Alisen Hazzard
 * ====================================== */
var DECKVIZ,_this=this;DECKVIZ=function(){var a,b,c,d,e,f,g,h;return e={},d={},b={},a={},c={},f={},g=function(){return!0},h={capitalize:function(a){return a.charAt(0).toUpperCase()+a.substring(1)}},{Views:e,Models:d,Collections:b,Charts:a,Deck:c,init:g,util:h}}();var _this=this;DECKVIZ.util.convertedManaCost=function(a){var b;return a===null||a===void 0?null:(typeof a=="number"&&(a=""+a+""),a=a.replace(/X/gi,""),b=parseInt(a,10)||0,b+=(a.match(/[UWBRG]/gi)||[]).length,b-=(a.match(/\([^pP]\/[^pP]\)/gi)||[]).length,b)},DECKVIZ.util.colorScale={R:"#ff0000",G:"#00ff00",B:"#000000",U:"#0000ff",W:"#D6AC51",X:"#707070"};var _this=this;DECKVIZ.Charts.Cards=function(){var a,b,c;return c=$("#svg-el").attr("width"),b=$("#svg-el").attr("height"),a={R:"#ff0000",G:"#00ff00",B:"#000000",U:"#0000ff",W:"#D6AC51",X:"#707070"},d3.json("/items/setText=ISD|M13|DKA|AVR&sort=color,manacost/",function(d){var e,f,g,h;return h=d3.scale.linear().domain([0,18]).range([0,b]),g=d3.scale.ordinal().domain(d3.range(d.cards.length)).rangeBands([0,c],.2),f=function(a){var b,c;return b=!1,a.match(/X/gi)&&(b=!0),c=parseInt(a,10),c+=(a.match(/[UWBRGX]/gi)||[]).length,b&&(c*=-1),c},e=d3.select("#svg-el").selectAll("rect.bars").data(d.cards).enter().append("rect").attr("class","bars").attr("width",function(a,b){return g.rangeBand()}).attr("height",function(a,b){return h(f(a.manacost||"0"))}).attr("fill",function(b,c){return a[b.color||"X"]}).attr("transform",function(a,c){var d,e;return d=g(c),e=b-h(f(a.manacost||"0")),"translate("+[d,e]+")"}).on("mouseover",function(a,b){return console.log(a.manacost,a.color,a.name,a.type,a)})}),!0};var _this=this;DECKVIZ.Deck.getDeckFromInput=function(a){var b,c,d,e,f,g,h,i;if(!a)return!1;a=a||{},a.el&&(f=el.val()),a.deckText&&(f=a.deckText),console.log(f),e=f.split("\n"),d={};for(h=0,i=e.length;h<i;h++)c=e[h],g=parseInt(c.replace(/[^0-9 ]/gi,""),10),b=c.replace(/[0-9]+ */gi,""),d[b]=g;return d},$("#deck").on("keyup",function(a){return DECKVIZ.Deck.create(DECKVIZ.Deck.getDeckFromInput({deckText:$("#deck").val()}))}),DECKVIZ.Deck.create=function(a){var b,c,d,e,f;a||(a={"Tamiyo, the Moon Sage":2,"Entreat the Angels":3,Terminus:4,"Lingering Souls":4,"Isolated Chapel":1,Spellskite:1,Dismember:3,"Pristine Talisman":4,"White Sun's Zenith":1,"Seachrome Coast":4,"Gideon Jura":3,"Day of Judgment":2,"Glacial Fortress":4,"Drowned Catacomb":4,"Oblivion Ring":3,"Think Twice":4,"Ghost Quarter":4,Swamp:1,Island:3,Plains:5},a={Mutilate:4,"Liliana's Shade":3,Murder:3,"Killing Wave":4,"Demonic Taskmaster":3,Swamp:23,"Nefarox, Overlord of Grixis":2,"Homicidal Seclusion":2,Duress:4,"Appetite for Brains":3,"Death Wind":4,"Shimian Specter":2,"Essence Harvest":3}),f=[];for(b in a)d=a[b],f.push("^"+b+"$");return e="/items/name="+f.join("|"),c=[],$.ajax({url:e,success:function(b){var d,e,f,g,h,i;h=b.cards;for(f=0,g=h.length;f<g;f++){d=h[f];for(e=0,i=a[d.name]-1;0<=i?e<=i:e>=i;0<=i?e++:e--)c.push(d)}return DECKVIZ.Deck.manaCurve(c,a)}})},DECKVIZ.Deck.manaCurve=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;$("#svg-el").empty(),o=$("#svg-el").attr("width"),i=$("#svg-el").attr("height"),c=DECKVIZ.util.convertedManaCost,k={},n=[];for(r=0,s=a.length;r<s;r++)d=a[r],k[c(d.manacost)]?k[c(d.manacost)]+=1:k[c(d.manacost)]=1,d.manacost&&n.push(d);f=_.clone(a),a=n,j=[];for(g in k)l=k[g],h=parseInt(g,10),h&&j.push([h,l]);return p=d3.scale.linear().domain([0,9]).range([0,o]),m=i,i-=100,q=d3.scale.linear().domain([0,60]).rangeRound([0,i]),e=d3.select("#svg-el").selectAll("rect").data(j).enter(),e.append("rect").attr("x",function(a,b){return p(a[0])-.5}).attr("y",function(a){return g=c(a.manacost),i-q(a[1])-.5}).attr("width",function(a,b){return o/(j.length*2)}).attr("height",function(a){return g=c(a.manacost),q(a[1])-.5}).style("fill",function(a,b){return DECKVIZ.util.colorScale.X}),e.append("text").attr("x",function(a,b){return p(a[0])-.5+o/(j.length*2)/2}).attr("y",i+20).text(function(a,b){return a[0]}),d3.select("#svg-el").append("line").attr("x1",0).attr("x2",o).attr("y1",i-.5).attr("y2",i-.5).style("stroke","#000"),!0};