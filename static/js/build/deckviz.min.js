/* ======================================
 * Title: Data Viz
 * Author: Erik & Alisen Hazzard
 * ====================================== */
var DECKVIZ,_this=this;DECKVIZ=function(){var a,b,c,d,e,f,g,h;return e={},d={},b={},a={},c={},f={},g=function(){return!0},h={capitalize:function(a){return a.charAt(0).toUpperCase()+a.substring(1)}},{Views:e,Models:d,Collections:b,Charts:a,Deck:c,init:g,util:h}}();var _this=this;DECKVIZ.util.convertedManaCost=function(a){var b;return a===null||a===void 0?null:(typeof a=="number"&&(a=""+a+""),a=a.replace(/X/gi,""),b=parseInt(a,10)||0,b+=(a.match(/[UWBRG]/gi)||[]).length,b-=(a.match(/\([^pP]\/[^pP]\)/gi)||[]).length,b)},DECKVIZ.util.colorScale={R:"#ff0000",G:"#00ff00",B:"#000000",U:"#0000ff",W:"#D6AC51",X:"#707070"};var _this=this;DECKVIZ.Charts.Cards=function(){var a,b,c;return c=$("#svg-el").attr("width"),b=$("#svg-el").attr("height"),a={R:"#ff0000",G:"#00ff00",B:"#000000",U:"#0000ff",W:"#D6AC51",X:"#707070"},d3.json("/items/setText=ISD|M13|DKA|AVR&sort=color,manacost/",function(d){var e,f,g,h;return h=d3.scale.linear().domain([0,18]).range([0,b]),g=d3.scale.ordinal().domain(d3.range(d.cards.length)).rangeBands([0,c],.2),f=function(a){var b,c;return b=!1,a.match(/X/gi)&&(b=!0),c=parseInt(a,10),c+=(a.match(/[UWBRGX]/gi)||[]).length,b&&(c*=-1),c},e=d3.select("#svg-el").selectAll("rect.bars").data(d.cards).enter().append("rect").attr("class","bars").attr("width",function(a,b){return g.rangeBand()}).attr("height",function(a,b){return h(f(a.manacost||"0"))}).attr("fill",function(b,c){return a[b.color||"X"]}).attr("transform",function(a,c){var d,e;return d=g(c),e=b-h(f(a.manacost||"0")),"translate("+[d,e]+")"}).on("mouseover",function(a,b){return console.log(a.manacost,a.color,a.name,a.type,a)})}),!0};var _this=this;DECKVIZ.Deck.getDeckFromInput=function(a){var b,c,d,e,f,g,h,i;if(!a)return!1;a=a||{},a.el&&(f=el.val()),a.deckText&&(f=a.deckText),e=f.split("\n"),d={};for(h=0,i=e.length;h<i;h++)c=e[h],g=parseInt(c.replace(/[^0-9 ]/gi,""),10),b=c.replace(/[0-9]+ */gi,""),d[b]=g;return d},DECKVIZ.Deck.getCardTypes=function(a){var b,c,d,e,f;c={},a=a||{};if(!a.deck)return!1;f=a.deck;for(d=0,e=f.length;d<e;d++)b=f[d],c[b.type]!=null?c[b.type]+=1:c[b.type]=0;return c},$("#deck").on("keyup",function(a){return DECKVIZ.Deck.create(DECKVIZ.Deck.getDeckFromInput({deckText:$("#deck").val()}))}),DECKVIZ.Deck.create=function(a){var b,c,d,e,f;a||(a={Mutilate:4,"Liliana's Shade":3,Murder:3,"Killing Wave":4,"Demonic Taskmaster":3,Swamp:23,"Nefarox, Overlord of Grixis":2,"Homicidal Seclusion":2,Duress:4,"Appetite for Brains":3,"Death Wind":4,"Shimian Specter":2,"Essence Harvest":3},a={"Tamiyo, the Moon Sage":2,"Entreat the Angels":3,Terminus:4,"Lingering Souls":4,"Isolated Chapel":1,Spellskite:1,Dismember:3,"Pristine Talisman":4,"White Sun's Zenith":1,"Seachrome Coast":4,"Gideon Jura":3,"Day of Judgment":2,"Glacial Fortress":4,"Drowned Catacomb":4,"Oblivion Ring":3,"Think Twice":4,"Ghost Quarter":4,Swamp:1,Island:3,Plains:5}),f=[];for(b in a)d=a[b],f.push("^"+b+"$");return e="/items/name="+f.join("|"),c=[],$.ajax({url:e,success:function(b){var d,e,f,g,h,i,j;i=b.cards;for(g=0,h=i.length;g<h;g++){d=i[g];for(f=0,j=a[d.name]-1;0<=j?f<=j:f>=j;0<=j?f++:f--)c.push(d)}return e=DECKVIZ.Deck.getCardTypes({deck:c}),console.log(JSON.stringify(e)),DECKVIZ.Deck.manaCurve(c,a)}})},DECKVIZ.Deck.manaCurve=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;s="#svg-el-deck-mana",$(s).empty(),v=$(s).attr("width"),i=$(s).attr("height"),m=10,q=[10,0,0,50],c=DECKVIZ.util.convertedManaCost,l={},u=[];for(A=0,B=a.length;A<B;A++)d=a[A],l[c(d.manacost)]?l[c(d.manacost)]+=1:l[c(d.manacost)]=1,d.manacost&&u.push(d);f=_.clone(a),a=u,k=[],n=0;for(g in l)o=l[g],h=parseInt(g,10),h&&(k.push([h,o]),h>n&&(n=h));return w=d3.scale.linear().domain([0,m]).range([q[3],v]),p=i,i-=100,j=20,n>20&&(j=n*1.2),z=d3.scale.linear().domain([0,j]).rangeRound([q[0],i]),r=d3.select(s),e=r.selectAll("rect").data(k).enter(),console.log(k),e.append("rect").attr("x",function(a,b){return w(a[0])-.5}).attr("width",function(a,b){return v/(m+2)}).style("fill",function(a,b){return DECKVIZ.util.colorScale.X}).attr("y",function(a){return i}).attr("height",function(a){return 0}).transition().attr("height",function(a){return z(a[1])-.5}).attr("y",function(a){return i-z(a[1])-.5}),e.append("text").text(function(a,b){return a[1]}).attr("x",function(a,b){return w(a[0])-5+v/(m+2)/2}).attr("y",i-15).style("fill","#ffffff").style("text-shadow","0 -1px 2px #000000"),r.selectAll("text.label").data(function(){var a;a=[];for(o=0;0<=m?o<=m:o>=m;0<=m?o++:o--)a.push(o);return a}()).enter().append("svg:text").attr("class","label").attr("x",function(a,b){return w(a)-.5+v/(m+2)/2}).attr("y",i+20).text(function(a,b){return a}),r.append("line").attr("x1",q[3]).attr("x2",v).attr("y1",i-.5).attr("y2",i-.5).style("stroke","#000"),t=d3.scale.linear().domain([j,0]).rangeRound([q[0],i]),x=d3.svg.axis().scale(t).ticks(9).orient("left"),y=r.append("g").attr("transform","translate("+[q[3],0]+")").classed("yaxis",!0).call(x),y.selectAll("path").style("fill","none").style("stroke","#000"),y.selectAll("line").style("fill","none").style("stroke","#000"),!0},DECKVIZ.Deck.deckPie=function(a,b){var c,d,e,f,g;return f="#svg-el-deck-pie",$(f).empty(),g=$(f).attr("width"),c=$(f).attr("height"),e=d3.select(f),d=d3.layout.pie};